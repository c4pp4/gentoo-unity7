From 9c8df247dbb03327efb5b10c4c123edd3b9dea0b Mon Sep 17 00:00:00 2001
From: c4pp4
Date: Mon, 25 Oct 2021 16:58:26 +0200
Subject: [PATCH 1/1] Disable headerbar close button when not in GNOME

Signed-off-by: c4pp4
---
 src/hdy-header-bar.c | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)

diff --git a/src/hdy-header-bar.c b/src/hdy-header-bar.c
index e07f31a..241acaf 100644
--- a/src/hdy-header-bar.c
+++ b/src/hdy-header-bar.c
@@ -2540,6 +2540,29 @@ hdy_header_bar_get_show_close_button (HdyHeaderBar *self)
   return priv->shows_wm_decorations;
 }
 
+static gboolean
+in_desktop (const gchar *name)
+{
+  const gchar *desktop_name_list;
+  gchar **names;
+  gboolean in_list = FALSE;
+  gint i;
+
+  desktop_name_list = g_getenv ("XDG_CURRENT_DESKTOP");
+  if (!desktop_name_list)
+    return FALSE;
+
+  names = g_strsplit (desktop_name_list, ":", -1);
+  for (i = 0; names[i] && !in_list; i++)
+    if (strcmp (names[i], name) == 0) {
+      in_list = TRUE;
+      break;
+    }
+  g_strfreev (names);
+
+  return in_list;
+}
+
 /**
  * hdy_header_bar_set_show_close_button:
  * @self: a #HdyHeaderBar
@@ -2560,6 +2583,8 @@ hdy_header_bar_set_show_close_button (HdyHeaderBar *self,
 
   priv = hdy_header_bar_get_instance_private (self);
 
+  if (!in_desktop("GNOME"))
+    setting = FALSE;
   setting = setting != FALSE;
 
   if (priv->shows_wm_decorations == setting)
-- 
2.32.0

