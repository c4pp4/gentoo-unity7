From 6d75339dbf4f86124fc7de9b0b056f57f0003651 Mon Sep 17 00:00:00 2001
From: c4pp4
Date: Mon, 6 Jun 2022 16:41:54 +0200
Subject: [PATCH 1/1] Remove Gdk-Wayland dependency

Signed-off-by: c4pp4
---
 meson.build               |  2 +-
 src/Portal.vala           | 10 +---------
 vapi/gdk-wayland-3.0.vapi | 10 ----------
 3 files changed, 2 insertions(+), 20 deletions(-)
 delete mode 100644 vapi/gdk-wayland-3.0.vapi

diff --git a/meson.build b/meson.build
index a5f9061..5fb0bbc 100644
--- a/meson.build
+++ b/meson.build
@@ -64,7 +64,7 @@ endif
 libraw = dependency('libraw', version : '>= 0.13.2')
 libexif = dependency('libexif', version : '>= 0.6.16')
 unity = dependency('unity', required : false)
-gdk = [ dependency('gdk-x11-3.0'), dependency('gdk-wayland-3.0') ]
+gdk = dependency('gdk-x11-3.0')
 
 unity_available = false
 if unity.found() and get_option('unity-support')
diff --git a/src/Portal.vala b/src/Portal.vala
index c2e8e1e..51e1c18 100644
--- a/src/Portal.vala
+++ b/src/Portal.vala
@@ -53,15 +53,7 @@ public class Portal : GLib.Object {
     private static async string get_parent_window () {
         var window = AppWindow.get_instance().get_window ();
 
-        if (window is Gdk.Wayland.Window) {
-            var handle = "wayland:";
-            ((Gdk.Wayland.Window) window).export_handle ((w, h) => {
-                handle += h;
-                get_parent_window.callback ();
-            });
-            yield;
-            return handle;
-        } else if (window is Gdk.X11.Window) {
+        if (window is Gdk.X11.Window) {
             return "x11:%x".printf ((uint) ((Gdk.X11.Window) window).get_xid ());
         } else {
             warning ("Could not get parent window");
diff --git a/vapi/gdk-wayland-3.0.vapi b/vapi/gdk-wayland-3.0.vapi
deleted file mode 100644
index 81e0a25..0000000
--- a/vapi/gdk-wayland-3.0.vapi
+++ /dev/null
@@ -1,10 +0,0 @@
-[CCode (cheader_filename = "gdk/gdkwayland.h")]
-namespace Gdk.Wayland {
-    [CCode (type_id = "GDK_TYPE_WAYLAND_WINDOW", type_check_function = "GDK_IS_WAYLAND_WINDOW")]
-    public class Window : Gdk.Window {
-        public bool export_handle (owned WindowExported callback);
-    }
-
-    [CCode (instance_pos = 2.9)]
-    public delegate void WindowExported (Gdk.Window window, string handle);
-}
-- 
2.35.1

